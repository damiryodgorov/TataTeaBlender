<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FTI Touch Display</title>
   
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/app.css" />

    <script src="node_modules/babel-core/browser.min.js"></script>
     <script src="scripts/smoothie.js"></script>
  <script src="scripts/react.min.js"></script>
  <script src="node_modules/react-dom/dist/react-dom.min.js"></script>
   <script src="node_modules/socket.io-client/socket.io.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script>

let vdefList ={};
var Vdef;
var pVdef;
let isVdefSet = false;
var nVdf;
const value_groups = {
  "Calibration"  : ["AutoPhasePacks", "CalibrateMode", "PhaseTrigLimit", "PhaseTrigThres","PhaseLimitDry","PhaseLimitDrySpread",
                  "PhaseAngle", "PhaseLimitWet","PhaseLimitWetSpread","MPhaseOrder","MPhaseDD","MPhaseRD","PhaseSpeed",
                  "OscPower","PhaseMode","PhaseModeHold","AutoLearn"],
  "Faults"       : ["FaultStore","Mask", "FaultLatch", "FaultRejMode", "FlashRejCount", "Rej2Fault", "TOGGLE_REJ_MODE","FaultClearTime"], 
  "Output"       : ["BannerBuzzMode", "BannerMode", "BannerRejMode","IOBoardType","LightStackMode"],
  "Password"     : ["PassAccCal", "PassAccClrFaults", "PassAccClrLatch", "PassAccClrRej", "PassAccProd", "PassAccSelUnit", 
                      "PassAccSens", "PassAccTest", "PassOn", "PW1", "PW2", "PW3", "PW4","PassAccTime","PassAccSync"],
  "Rej Setup"    : ["AppUnitDist", "BeltSpeed",  "EyeBlockTime", "EyeDetSwipe", "EyeDist", "EyeMinGapDist", "EyePkgLength", 
                      "EyeReject", "HeadCoilSp", "HeadDepth", "Rej2Check", "Rej2Latch", "RejBinDoorTime", "RejCheckMode",
                      "RejCheckTime", "RejDelClock", "RejDelSec", "RejDelSec2", "RejDurSec", "RejDurSec2", "RejExitDist",
                        "RejExitWin", "RejLatchMode", "RejMode", "RejOnProdHi", "RejTravDel", "RejTravDur", "SplitPkgLength",
                        "PowerupRej","ExcessRejects","ExcessRejTime"],
  "Sensitivity" : ["PeakMode","Sens","BigMetThres","DetMode","ThresX","ThresR","DetThresh","ThresProdHi","FilterNoise","DcCoeffNorm"],
  "Test"        : ["HaloBoard","HaloPeakRFe", "HaloPeakRNFe", "HaloPeakRSs", "HaloPeakXFe", "HaloPeakXNFe", "HaloPeakXSs", 
                    "IBTestPassesFe", "IBTestPassesNFe", "IBTestPassesSS", "TestMode", "TestTime","TestDeferTime"],
  "Input"       : ["CIPCycleTime","CIPDwellTime"]                      
}  

const _testMap = [[{count:'TestConfigCount0_0',metal:'TestConfigMetal0_0'},{count:'TestConfigCount0_1',metal:'TestConfigMetal0_1'},{count:'TestConfigCount0_2',metal:'TestConfigMetal0_2'}],
                  [{count:'TestConfigCount1_0',metal:'TestConfigMetal1_0'},{count:'TestConfigCount1_1',metal:'TestConfigMetal1_1'},{count:'TestConfigCount1_2',metal:'TestConfigMetal1_2'}],
                  [{count:'TestConfigCount2_0',metal:'TestConfigMetal2_0'},{count:'TestConfigCount2_1',metal:'TestConfigMetal2_1'},{count:'TestConfigCount2_2',metal:'TestConfigMetal2_2'}],
                  [{count:'TestConfigCount3_0',metal:'TestConfigMetal3_0'},{count:'TestConfigCount3_1',metal:'TestConfigMetal3_1'},{count:'TestConfigCount3_2',metal:'TestConfigMetal3_2'}]]
const _testSettingsMap = [{ack:'TestConfigAck0',op:'TestConfigOperater0',haloMode:'TestConfigHaloMode0'},
                          {ack:'TestConfigAck1',op:'TestConfigOperater1',haloMode:'TestConfigHaloMode1'},
                          {ack:'TestConfigAck2',op:'TestConfigOperater2',haloMode:'TestConfigHaloMode2'},
                          {ack:'TestConfigAck3',op:'TestConfigOperater3',haloMode:'TestConfigHaloMode3'}]
      function load_vdef_parameters(json) {
  // body...
  if (vdefList[json['@version']]){
    console.log('already have this version')

  }else{
      Vdef = json;
  console.log(json)
  var res = [];
    res[0] = [];
    res[1] = [];
    res[2] = [];
    res[3] = [];
    nVdf = {};
    nVdf['Other'] = [];
    nVdf['Password'] = [];
    nVdf['Rej Setup'] = [];
    nVdf['Faults'] = [];
    nVdf['Output'] = [];
    nVdf['Sensitivity'] = [];
    nVdf['Test'] = [];
    nVdf['Calibration'] = [];

    json["@params"].forEach(function(p ){
      res[p["@rec"]][p["@name"]] = p;
     var nm = p['@name'];
     var otherFlag = true;
     for(var o in value_groups){
     // console.log(o)
     if(o == 'Faults'){
      if(nm.indexOf('FaultMask')!=1){
        nVdf[o].push(p);
        otherFlag = false;
        break;
      }
     }else if(o == 'Test'){
      if(nm.indexOf('TestConfig')!= -1){
        nVdf[o].push(p);
        otherFlag = false;
        break;
      }
     }
     if(value_groups[o].indexOf(nm) != -1){
      nVdf[o].push(p);
      otherFlag = false;
      break;
     }
   }
   if(otherFlag){  
      nVdf['Other'].push(p)
   }
    });
    console.log(nVdf)
    res[2] = json["@deps"];
    res[3] = json["@labels"]
    pVdef = res;
    vdefList[json['@version']] = [json, res, nVdf]
    isVdefSet = true;
    

  }

  //isVdefSet = true;
}
    </script>
  <!--  <script type="text/babel" src="scripts/components.js"></script>-->
    <script type="text/babel" src="scripts/app.js"></script>
     </body>
</html>
